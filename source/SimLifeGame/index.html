<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Life Simulator</title>
    <meta name="description" content="Live 25 years in 30 minutes - Financial life simulation game">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2196F3">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
        }
        
        .game-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
        }
        
        .version-badge {
            font-size: 0.8em;
            color: #666;
            background: #f0f0f0;
            padding: 4px 8px;
            border-radius: 12px;
            white-space: nowrap;
        }
        
        .game-status {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .status-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 12px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            text-align: center;
            border: 2px solid #dee2e6;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            position: relative;
            overflow: hidden;
        }
        
        .status-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }
        
        .status-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--card-accent, #6c757d);
        }
        
        /* Age Card - Life/Time Theme */
        .status-card:nth-child(1) {
            --card-accent: #17a2b8;
            background: linear-gradient(135deg, #e8f4f8 0%, #d1ecf1 100%);
            border-color: #17a2b8;
        }
        
        /* Cash Card - Money Theme */
        .status-card:nth-child(2) {
            --card-accent: #28a745;
            background: linear-gradient(135deg, #e8f5e9 0%, #d4edda 100%);
            border-color: #28a745;
        }
        
        /* Net Worth Card - Wealth Theme */
        .status-card:nth-child(3) {
            --card-accent: #ffc107;
            background: linear-gradient(135deg, #fff8e1 0%, #fff3cd 100%);
            border-color: #ffc107;
        }
        
        /* Profession Card - Career Theme */
        .status-card:nth-child(4) {
            --card-accent: #6f42c1;
            background: linear-gradient(135deg, #f0ebf8 0%, #e2d9f3 100%);
            border-color: #6f42c1;
        }
        
        /* Happiness Card - Emotion Theme */
        .status-card:nth-child(5) {
            --card-accent: #e91e63;
            background: linear-gradient(135deg, #fce4ec 0%, #f8bbd9 100%);
            border-color: #e91e63;
        }
        
        /* Monthly Expenses Card - Cost Theme */
        .status-card:nth-child(6) {
            --card-accent: #dc3545;
            background: linear-gradient(135deg, #f8e6e7 0%, #f1aeb5 100%);
            border-color: #dc3545;
        }
        
        .status-value {
            font-size: 1.6em;
            font-weight: bold;
            margin-bottom: 8px;
            color: #2c3e50;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }
        
        .status-label {
            color: #495057;
            font-size: 0.95em;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .progress-bar {
            width: 100%;
            height: 30px;
            background: #f0f0f0;
            border-radius: 15px;
            overflow: hidden;
            margin: 15px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #45a049);
            transition: width 1s linear;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-bottom: 30px;
            width: 100%;
        }
        
        .second-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            align-items: stretch;
            width: 100%;
            clear: both;
        }
        
        
        .second-row .game-panel {
            height: 280px;
            overflow-y: auto;
            min-width: 0; /* Prevent grid blowout */
        }
        
        .second-row .game-panel:nth-child(1) {
            grid-column: 1;
        }
        
        .second-row .game-panel:nth-child(2) {
            grid-column: 2;
        }
        
        .second-row .game-panel:nth-child(3) {
            grid-column: 3;
        }
        
        .main-content .game-panel {
            height: 240px;
            overflow-y: auto;
        }
        
        .game-panel {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
        }
        
        .command-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            margin-bottom: 15px;
        }
        
        .command-input:focus {
            outline: none;
            border-color: #2196F3;
        }
        
        .command-help {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            font-size: 0.9em;
        }
        
        .log-area {
            height: 240px;
            overflow-y: auto;
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 0.85em;
            max-width: 100%;
            word-wrap: break-word;
            overflow-wrap: break-word;
            box-sizing: border-box;
        }
        
        .log-entry {
            margin-bottom: 8px;
            padding: 5px;
            border-radius: 3px;
            word-wrap: break-word;
            overflow-wrap: break-word;
            max-width: 100%;
            box-sizing: border-box;
        }
        
        .log-info { background: #e3f2fd; }
        .log-success { background: #e8f5e8; }
        .log-warning { background: #fff3cd; }
        .log-error { background: #f8d7da; }
        .log-positive { background: #d4edda; }
        .log-lottery { background: #cce7ff; color: #0066cc; font-weight: bold; }
        .log-loss { background: #ffe6e6; color: #cc0000; }
        
        /* News Ticker Styles */
        .news-ticker {
            background: linear-gradient(90deg, #1e3c72, #2a5298);
            color: white;
            padding: 8px 0;
            white-space: nowrap;
            overflow: hidden;
            position: relative;
            border-top: 2px solid #0066cc;
            border-bottom: 2px solid #0066cc;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .news-ticker-content {
            display: inline-block;
            animation: scroll-left 30s linear infinite;
            padding-left: 100%;
        }
        
        .news-item {
            font-size: 14px;
            font-weight: 500;
            margin-right: 50px;
            display: inline-block;
        }
        
        @keyframes scroll-left {
            from { transform: translateX(0); }
            to { transform: translateX(-100%); }
        }
        
        .news-ticker:hover .news-ticker-content {
            animation-play-state: paused;
        }
        
        /* Responsive news ticker for mobile */
        @media (max-width: 768px) {
            .news-ticker {
                padding: 6px 0;
            }
            .news-item {
                font-size: 12px;
            }
            .news-ticker-content {
                animation-duration: 25s;
            }
        }
        
        .portfolio-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }
        
        .portfolio-item {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
        }
        
        .btn {
            background: #2196F3;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }
        
        .btn:hover {
            background: #1976D2;
        }
        
        .btn-danger {
            background: #f44336;
        }
        
        .btn-danger:hover {
            background: #d32f2f;
        }
        
        .game-over {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .game-over-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            max-width: 500px;
            margin: 20px;
        }
        
        .profession-selection {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1001;
        }
        
        .profession-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            max-width: 900px;
            max-height: 80vh;
            margin: 20px;
            text-align: center;
            overflow-y: auto;
        }
        
        .profession-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
            margin: 30px 0;
            max-height: 60vh;
            overflow-y: auto;
            padding: 15px;
            border: 1px solid #e9ecef;
            border-radius: 10px;
            scrollbar-width: thin;
            scrollbar-color: #2196F3 #f1f1f1;
        }
        
        .profession-grid::-webkit-scrollbar {
            width: 8px;
        }
        
        .profession-grid::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        
        .profession-grid::-webkit-scrollbar-thumb {
            background: #2196F3;
            border-radius: 4px;
        }
        
        .profession-grid::-webkit-scrollbar-thumb:hover {
            background: #1976D2;
        }
        
        .profession-card {
            background: #f8f9fa;
            border: 3px solid #e9ecef;
            border-radius: 15px;
            padding: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
        }
        
        .profession-card:hover {
            border-color: #2196F3;
            box-shadow: 0 8px 25px rgba(33, 150, 243, 0.3);
            transform: translateY(-2px);
        }
        
        .profession-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #2196F3;
            margin-bottom: 10px;
        }
        
        .profession-salary {
            font-size: 1.1em;
            font-weight: bold;
            color: #4CAF50;
            margin-bottom: 10px;
        }
        
        .profession-details {
            font-size: 0.9em;
            color: #666;
            line-height: 1.4;
        }
        
        .profession-loan {
            background: #fff3cd;
            padding: 8px;
            border-radius: 5px;
            margin-top: 10px;
            font-size: 0.8em;
            color: #856404;
        }
        
        .assets-section {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .asset-category {
            background: #f8f9fa;
            margin-bottom: 10px;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .asset-header {
            background: #e9ecef;
            padding: 10px 15px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .asset-items {
            padding: 10px 15px;
            display: none;
        }
        
        .asset-items.expanded {
            display: block;
        }
        
        .asset-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 0;
            border-bottom: 1px solid #dee2e6;
        }
        
        .asset-item:last-child {
            border-bottom: none;
        }
        
        .asset-name {
            font-weight: 500;
        }
        
        .asset-value {
            color: #28a745;
            font-weight: bold;
        }
        
        .asset-debt {
            color: #dc3545;
            font-weight: bold;
        }
        
        .stock-info-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1003;
            animation: fadeIn 0.3s ease-in-out;
        }
        
        .stock-info-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 800px;
            max-height: 80vh;
            margin: 20px;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s ease-in-out;
        }
        
        .stock-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e9ecef;
        }
        
        .stock-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .stock-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #2196F3;
        }
        
        .stock-section h3 {
            margin: 0 0 15px 0;
            color: #2196F3;
            font-size: 1.2em;
        }
        
        .stock-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #dee2e6;
            min-height: 40px;
            flex-shrink: 0;
        }
        
        .stock-item:last-child {
            border-bottom: none;
        }
        
        .stock-symbol {
            font-weight: bold;
            color: #333;
        }
        
        .stock-price {
            font-weight: bold;
            color: #28a745;
        }
        
        .crypto-price {
            font-weight: bold;
            color: #6f42c1;
        }
        
        .expense-breakdown-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1004;
            animation: fadeIn 0.3s ease-in-out;
        }
        
        .expense-breakdown-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 800px;
            max-height: 90vh;
            margin: 20px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s ease-in-out;
            display: flex;
            flex-direction: column;
        }
        
        .player-status-content {
            background: white;
            padding: 35px;
            border-radius: 15px;
            max-width: 1400px;
            width: 95vw;
            max-height: 95vh;
            margin: 15px;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s ease-in-out;
            display: flex;
            flex-direction: column;
        }
        
        .expense-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #e9ecef;
        }
        
        .expense-item:last-child {
            border-bottom: 2px solid #2196F3;
            font-weight: bold;
            font-size: 1.1em;
        }
        
        .expense-category {
            font-weight: 500;
            color: #333;
        }
        
        .expense-amount {
            font-weight: bold;
            color: #dc3545;
        }
        
        .expense-total {
            color: #2196F3 !important;
        }
        
        .event-popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1002;
            animation: fadeIn 0.3s ease-in-out;
        }
        
        .event-popup-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            margin: 20px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s ease-in-out;
        }
        
        .event-title {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 15px;
            color: #2196F3;
        }
        
        .event-description {
            font-size: 1.1em;
            margin-bottom: 20px;
            line-height: 1.6;
            color: #333;
        }
        
        .event-impact {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #2196F3;
        }
        
        .event-cost {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .event-cost.positive {
            color: #28a745;
        }
        
        .event-cost.negative {
            color: #dc3545;
        }
        
        .event-happiness {
            font-size: 1em;
            color: #666;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from { 
                opacity: 0;
                transform: translateY(20px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @media (max-width: 1200px) {
            .game-container {
                padding: 15px;
            }
            
            .stock-grid {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 968px) {
            .second-row {
                grid-template-columns: 1fr 1fr;
            }
            
            .game-panel {
                padding: 15px;
            }
            
            .status-card {
                padding: 12px;
            }
            
            .status-value {
                font-size: 1.3em;
            }
        }
        
        @media (max-width: 768px) {
            .main-content, .second-row {
                grid-template-columns: 1fr;
            }
            
            .game-status {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
            }
            
            .status-card {
                padding: 14px;
                border-radius: 12px;
            }
            
            .status-value {
                font-size: 1.3em;
                margin-bottom: 6px;
            }
            
            .status-label {
                font-size: 0.85em;
            }
            
            .profession-grid {
                grid-template-columns: 1fr;
            }
            
            .profession-content {
                padding: 20px;
                margin: 10px;
            }
            
            .header {
                padding: 15px;
            }
            
            .version-badge {
                font-size: 0.7em;
                padding: 3px 6px;
            }
            
            .game-panel {
                padding: 12px;
            }
            
            .log-area {
                height: 200px;
                font-size: 0.8em;
            }
            
            .second-row .game-panel {
                height: auto;
                min-height: 250px;
            }
            
            .btn {
                padding: 8px 15px;
                font-size: 13px;
                margin: 3px;
            }
            
            .stock-info-content, .expense-breakdown-content {
                padding: 20px;
                margin: 10px;
                max-height: 85vh;
            }
            
            .player-status-content {
                padding: 25px;
                margin: 10px;
                max-height: 90vh;
                width: 90vw;
            }
            
            #player-status-content {
                grid-template-columns: repeat(2, 1fr) !important;
                gap: 20px !important;
            }
            
            .event-popup-content {
                padding: 20px;
                margin: 15px;
            }
        }
        
        @media (max-width: 480px) {
            .game-container {
                padding: 10px;
            }
            
            .game-status {
                grid-template-columns: 1fr;
                gap: 8px;
            }
            
            .status-card {
                padding: 10px;
            }
            
            .status-value {
                font-size: 1.2em;
            }
            
            .status-label {
                font-size: 0.8em;
            }
            
            .header {
                padding: 12px;
            }
            
            .version-badge {
                font-size: 0.65em;
                padding: 2px 5px;
            }
            
            .game-panel {
                padding: 10px;
            }
            
            .log-area {
                height: 150px;
                font-size: 0.75em;
                padding: 10px;
            }
            
            .btn {
                padding: 6px 12px;
                font-size: 12px;
                margin: 2px;
                width: 100%;
                margin-bottom: 5px;
            }
            
            .portfolio-grid {
                grid-template-columns: 1fr;
            }
            
            .asset-header {
                padding: 8px 12px;
                font-size: 0.9em;
            }
            
            .asset-items {
                padding: 8px 12px;
            }
            
            .asset-item {
                font-size: 0.85em;
                padding: 3px 0;
            }
            
            .stock-info-content, .expense-breakdown-content {
                padding: 15px;
                margin: 5px;
                max-height: 90vh;
            }
            
            .player-status-content {
                padding: 20px;
                margin: 5px;
                max-height: 92vh;
                width: 98vw;
            }
            
            #player-status-content {
                grid-template-columns: repeat(2, 1fr) !important;
                gap: 15px !important;
            }
            
            .profession-content {
                padding: 15px;
                margin: 5px;
            }
            
            .profession-card {
                padding: 15px;
            }
            
            .event-popup-content {
                padding: 15px;
                margin: 10px;
            }
            
            .command-input {
                padding: 12px;
                font-size: 14px;
            }
            
            .command-help {
                font-size: 0.8em;
                padding: 12px;
            }
        }
        
        @media (max-width: 360px) {
            .game-container {
                padding: 8px;
            }
            
            .header, .game-panel {
                padding: 8px;
            }
            
            .status-value {
                font-size: 1.1em;
            }
            
            .btn {
                font-size: 11px;
                padding: 5px 10px;
            }
            
            .log-area {
                height: 120px;
            }
            
            .player-status-content {
                padding: 15px;
                margin: 2px;
                width: 99vw;
            }
            
            #player-status-content {
                grid-template-columns: 1fr !important;
                gap: 10px !important;
            }
        }
        
        /* Pets Modal Styles */
        .pets-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        
        .pets-section {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
        }
        
        .pets-section h3 {
            margin-bottom: 15px;
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 5px;
        }
        
        .pets-grid {
            display: grid;
            gap: 10px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .pet-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            border: 2px solid #e0e0e0;
            transition: all 0.3s ease;
        }
        
        .pet-card:hover {
            border-color: #3498db;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .pet-card.owned {
            border-color: #28a745;
            background: #f8fff9;
        }
        
        .pet-card.unavailable {
            opacity: 0.6;
            background: #f5f5f5;
        }
        
        .pet-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .pet-name {
            font-weight: bold;
            font-size: 1.1em;
            color: #2c3e50;
        }
        
        .pet-price {
            background: #3498db;
            color: white;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.9em;
        }
        
        .pet-info {
            margin: 8px 0;
            font-size: 0.9em;
            color: #666;
        }
        
        .pet-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 5px;
            margin: 10px 0;
            font-size: 0.85em;
        }
        
        .pet-stat {
            background: #e3f2fd;
            padding: 3px 6px;
            border-radius: 4px;
            text-align: center;
        }
        
        .pet-actions {
            display: flex;
            gap: 5px;
            margin-top: 10px;
        }
        
        .pet-btn {
            flex: 1;
            padding: 8px 12px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background 0.3s ease;
        }
        
        .pet-btn.buy {
            background: #28a745;
            color: white;
        }
        
        .pet-btn.buy:hover {
            background: #218838;
        }
        
        .pet-btn.sell {
            background: #dc3545;
            color: white;
        }
        
        .pet-btn.sell:hover {
            background: #c82333;
        }
        
        .pet-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            opacity: 0.6;
        }
        
        .pet-categories {
            display: flex;
            gap: 5px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .category-btn {
            padding: 6px 12px;
            border: 2px solid #dee2e6;
            background: white;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
        }
        
        .category-btn.active {
            background: #3498db;
            color: white;
            border-color: #3498db;
        }
        
        .category-btn:hover {
            border-color: #3498db;
        }
        
        .pet-age {
            color: #666;
            font-size: 0.8em;
            font-style: italic;
        }
        
        .pet-requirements {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 4px;
            padding: 5px;
            margin-top: 5px;
            font-size: 0.8em;
            color: #856404;
        }
        
        /* Pet Display on Main Screen */
        .pets-display {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 15px;
        }
        
        .pets-visual {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            min-height: 50px;
            align-items: center;
        }
        
        .pet-visual-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            padding: 8px;
            min-width: 60px;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .pet-visual-item:hover {
            border-color: #3498db;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .pet-emoji {
            font-size: 24px;
            margin-bottom: 4px;
        }
        
        .pet-name-small {
            font-size: 0.7em;
            color: #666;
            text-align: center;
            line-height: 1.1;
        }
        
        .pet-age-small {
            font-size: 0.6em;
            color: #999;
            text-align: center;
        }
        
        @media (max-width: 768px) {
            .pets-container {
                grid-template-columns: 1fr;
            }
            
            .pet-categories {
                justify-content: center;
            }
        }
        
        /* Player Setup Styles */
        .player-setup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            overflow-y: auto;
        }
        
        .player-setup-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .setup-container {
            display: grid;
            gap: 25px;
            margin-top: 20px;
        }
        
        .setup-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            border: 2px solid #e9ecef;
        }
        
        .setup-section h3 {
            margin: 0 0 15px 0;
            color: #2c3e50;
            font-size: 1.2em;
        }
        
        .portrait-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(65px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }
        
        .portrait-option {
            width: 65px;
            height: 75px;
            border-radius: 8px;
            border: 2px solid #ddd;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: #f8f9fa;
            margin: 0 auto;
            padding: 4px;
        }
        
        .portrait-emoji {
            font-size: 24px;
            line-height: 1;
            margin-bottom: 2px;
        }
        
        .portrait-name {
            font-size: 9px;
            font-weight: 500;
            color: #666;
            line-height: 1.1;
            text-align: center;
            word-break: break-word;
        }
        
        .portrait-option:hover {
            border-color: #007bff;
            transform: scale(1.1);
        }
        
        .portrait-option.selected {
            border-color: #28a745;
            background: #e8f5e8;
            transform: scale(1.1);
        }
        
        .stats-display {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 15px;
        }
        
        .stat-item {
            background: white;
            padding: 12px;
            border-radius: 8px;
            border: 2px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .stat-name {
            font-weight: bold;
            color: #495057;
        }
        
        .stat-value {
            font-weight: bold;
            color: #007bff;
            font-size: 1.1em;
        }
        
        @media (max-width: 768px) {
            .player-setup-content {
                padding: 20px;
                margin: 10px;
            }
            
            .stats-display {
                grid-template-columns: 1fr;
            }
            
            .portrait-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }
        
        /* Celebration Effects */
        .celebration-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .celebration-message {
            background: rgba(255, 255, 255, 0.95);
            border: 3px solid #ffd700;
            border-radius: 20px;
            padding: 30px 40px;
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            color: #333;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            animation: celebrationPulse 2s ease-in-out;
        }
        
        .celebration-emoji {
            display: block;
            font-size: 48px;
            margin-bottom: 15px;
            animation: celebrationBounce 1s ease-in-out infinite alternate;
        }
        
        @keyframes celebrationPulse {
            0% { transform: scale(0.5); opacity: 0; }
            50% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        @keyframes celebrationBounce {
            0% { transform: translateY(0); }
            100% { transform: translateY(-10px); }
        }
        
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #ffd700;
            animation: confettiFall 3s linear infinite;
        }
        
        @keyframes confettiFall {
            0% { transform: translateY(-100vh) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(360deg); opacity: 0; }
        }
        
        .confetti:nth-child(1) { left: 10%; animation-delay: 0s; background: #ff6b6b; }
        .confetti:nth-child(2) { left: 20%; animation-delay: 0.2s; background: #4ecdc4; }
        .confetti:nth-child(3) { left: 30%; animation-delay: 0.4s; background: #45b7d1; }
        .confetti:nth-child(4) { left: 40%; animation-delay: 0.6s; background: #96ceb4; }
        .confetti:nth-child(5) { left: 50%; animation-delay: 0.8s; background: #feca57; }
        .confetti:nth-child(6) { left: 60%; animation-delay: 1s; background: #ff9ff3; }
        .confetti:nth-child(7) { left: 70%; animation-delay: 1.2s; background: #54a0ff; }
        .confetti:nth-child(8) { left: 80%; animation-delay: 1.4s; background: #5f27cd; }
        .confetti:nth-child(9) { left: 90%; animation-delay: 1.6s; background: #00d2d3; }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="header">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h1>Life Simulator</h1>
                <div style="display: flex; align-items: center; gap: 15px;">
                    <div id="player-info" style="display: none; text-align: right;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <span id="player-portrait-display" style="font-size: 24px;">👤</span>
                            <div>
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <span id="player-name-display" style="font-weight: bold; color: #2c3e50;">Player</span>
                                    <span id="player-age-display" style="font-size: 0.9em; color: #666; background: #f0f0f0; padding: 2px 6px; border-radius: 8px;">24</span>
                                </div>
                                <div style="font-size: 0.8em; color: #666;">Your Character</div>
                            </div>
                        </div>
                    </div>
                    <div class="version-badge" id="game-version">v2.7.2</div>
                </div>
            </div>
            <div class="game-status">
                <div class="status-card">
                    <div class="status-value" id="cash">$500</div>
                    <div class="status-label">💵 Cash</div>
                </div>
                <div class="status-card">
                    <div class="status-value" id="net-worth">$3,500</div>
                    <div class="status-label">💎 Net Worth</div>
                </div>
                <div class="status-card">
                    <div class="status-value" id="profession">Loading...</div>
                    <div class="status-label">💼 Profession</div>
                </div>
                <div class="status-card">
                    <div class="status-value" id="happiness">50 / 1000</div>
                    <div class="status-label">😊 Happiness</div>
                </div>
                <div class="status-card" onclick="showExpenseBreakdown()" style="cursor: pointer;" title="Click for detailed breakdown">
                    <div class="status-value" id="monthly-expenses">$0</div>
                    <div class="status-label">📊 Monthly Expenses</div>
                </div>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="month-progress" style="width: 100%; background: linear-gradient(90deg, #2196F3, #1976D2);">Ready for Actions</div>
            </div>
        </div>
        
            
            <!-- News Ticker -->
            <div class="news-ticker" id="news-ticker">
                <div class="news-ticker-content" id="news-ticker-content">
                    <span class="news-item">💡 Consider depositing excess cash in the bank! Cash on hand is vulnerable to theft and emergencies, but bank deposits are protected.</span>
                </div>
            </div>
            
            <div class="main-content">
            <div class="game-panel">
                <h3>Game Log</h3>
                <div class="log-area" id="game-log"></div>
            </div>
        </div>
        
        <div class="second-row">
            <div class="game-panel">
                <h3>Action Controls</h3>
                
                <!-- Financial & Investment -->
                <div style="margin-bottom: 10px;">
                    <h4 style="margin: 0 0 5px 0; color: #2c3e50; font-size: 0.9em;">💰 Financial & Investment</h4>
                    <button class="btn" onclick="showBankModal()" style="background: #28a745;">🏦 Bank</button>
                    <button class="btn" onclick="showStockInfo()" style="background: #6f42c1;">📈 Market Info</button>
                    <button class="btn" onclick="showStockTradingModal()" style="background: #007bff;">📈 Stocks</button>
                    <button class="btn" onclick="showCryptoTradingModal()" style="background: #ff6b35;">₿ Crypto</button>
                    <button class="btn" id="ask-parents-help-btn" onclick="askParentsForHelp()" style="background: #e74c3c;">👨‍👩‍👧‍👦 Ask Parents</button>
                </div>
                
                <!-- Assets & Property -->
                <div style="margin-bottom: 10px;">
                    <h4 style="margin: 0 0 5px 0; color: #2c3e50; font-size: 0.9em;">🏠 Assets & Property</h4>
                    <button class="btn" onclick="showRealEstateModal()" style="background: #8b4513;">🏠 Real Estate</button>
                    <button class="btn" onclick="showVehicleModal()" style="background: #6c757d;">🚗 Vehicles</button>
                    <button class="btn" onclick="showPetsModal()" style="background: #ff69b4;">🐾 Pets</button>
                </div>
                
                <!-- Income & Entertainment -->
                <div style="margin-bottom: 10px;">
                    <h4 style="margin: 0 0 5px 0; color: #2c3e50; font-size: 0.9em;">🎯 Income & Entertainment</h4>
                    <button class="btn" onclick="doOneTimeSideJob()" style="background: #fd7e14;">💼 Side Job</button>
                    <button class="btn" onclick="showLotteryModal()" style="background: #ffc107;">🎰 Lottery</button>
                    <button class="btn" onclick="showSelfLearningModal()" style="background: #6f42c1;">📚 Self Learning</button>
                </div>
            </div>
            
            <div class="game-panel">
                <h3>Player Assets</h3>
                
                <!-- Pet Display Area -->
                <div class="pets-display" id="pets-display" style="display: none;">
                    <h4 style="margin: 10px 0 5px 0; color: #2c3e50;">🐾 Your Pets</h4>
                    <div class="pets-visual" id="pets-visual">
                        <!-- Pet images will appear here -->
                    </div>
                </div>
                
                <div class="assets-section" id="assets-section">
                    <div class="asset-category">
                        <div class="asset-header" onclick="toggleAssetCategory('cash-category')">
                            <span>💰 Cash & Bank</span>
                            <span>▼</span>
                        </div>
                        <div class="asset-items expanded" id="cash-category">
                            <div class="asset-item">
                                <span class="asset-name">Cash on Hand</span>
                                <span class="asset-value" id="asset-cash">$500</span>
                            </div>
                            <div class="asset-item">
                                <span class="asset-name">Bank Account</span>
                                <span class="asset-value" id="asset-bank">$0</span>
                            </div>
                            <div class="asset-item">
                                <span class="asset-name">Savings (3% APY)</span>
                                <span class="asset-value" id="asset-savings">$0</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="asset-category">
                        <div class="asset-header" onclick="toggleAssetCategory('investments-category')">
                            <span>📈 Investments</span>
                            <span>▼</span>
                        </div>
                        <div class="asset-items" id="investments-category">
                            <div id="stocks-list"></div>
                            <div id="crypto-list"></div>
                        </div>
                    </div>
                    
                    <div class="asset-category">
                        <div class="asset-header" onclick="toggleAssetCategory('vehicles-category')">
                            <span>🚗 Vehicles</span>
                            <span>▼</span>
                        </div>
                        <div class="asset-items" id="vehicles-category">
                            <div id="cars-list"></div>
                        </div>
                    </div>
                    
                    <div class="asset-category">
                        <div class="asset-header" onclick="toggleAssetCategory('property-category')">
                            <span>🏠 Real Estate</span>
                            <span>▼</span>
                        </div>
                        <div class="asset-items" id="property-category">
                            <div id="properties-list"></div>
                        </div>
                    </div>
                    
                    <div class="asset-category">
                        <div class="asset-header" onclick="toggleAssetCategory('debts-category')">
                            <span>💳 Debts & Loans</span>
                            <span>▼</span>
                        </div>
                        <div class="asset-items" id="debts-category">
                            <div id="loans-list"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="game-panel">
                <h3>Game Controls</h3>
                <button class="btn" onclick="game.endTurn()" style="background: #4CAF50;">End Turn</button>
                <button class="btn" onclick="showPlayerStatus()" style="background: #6f42c1;">👤 Status</button>
                <button class="btn" onclick="showCashFlowHistory()" style="background: #17a2b8;">💰 Cash Flow</button>
                <button class="btn" onclick="toggleBackgroundMusic()" id="music-toggle-btn" style="background: #ff6b35;">🎵 Music</button>
            </div>
        </div>
    </div>
    
    <!-- Player Setup Page -->
    <div class="player-setup" id="player-setup">
        <div class="player-setup-content">
            <h2>🎮 Create Your Character</h2>
            <p>Customize your appearance and roll your starting stats</p>
            
            <div class="setup-container">
                <!-- Name Section -->
                <div class="setup-section">
                    <h3>📝 Your Name</h3>
                    <input type="text" id="player-name" placeholder="Enter your name (or leave empty for 'Guest')..." maxlength="20" 
                           style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px; margin-top: 10px;">
                </div>
                
                <!-- Portrait Section -->
                <div class="setup-section">
                    <h3>👤 Choose Your Portrait</h3>
                    <div class="portrait-grid" id="portrait-grid">
                        <!-- Portrait options will be generated here -->
                    </div>
                </div>
                
                <!-- Stats Section -->
                <div class="setup-section">
                    <h3>📊 Your Starting Stats</h3>
                    <div class="stats-display" id="stats-display">
                        <div class="stat-item">
                            <span class="stat-name">Energy</span>
                            <span class="stat-value" id="stat-energy">75/100</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-name">Focus</span>
                            <span class="stat-value" id="stat-focus">70/100</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-name">Wisdom</span>
                            <span class="stat-value" id="stat-wisdom">65/100</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-name">Charm</span>
                            <span class="stat-value" id="stat-charm">60/100</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-name">Luck</span>
                            <span class="stat-value" id="stat-luck">55/100</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-name">PSP</span>
                            <span class="stat-value" id="stat-psp">50/150</span>
                        </div>
                    </div>
                    <button class="btn" onclick="randomizeStats()" style="background: #17a2b8; margin-top: 15px; width: 100%;">
                        🎲 Randomize Stats
                    </button>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 30px;">
                <button class="btn" onclick="startGameWithSetup()" style="background: #28a745; padding: 15px 30px; font-size: 18px;">
                    ✨ Start Your Life Journey
                </button>
            </div>
        </div>
    </div>

    <div class="profession-selection" id="profession-selection">
        <div class="profession-content">
            <h2>Choose Your Career Path</h2>
            <p>Select a profession to begin your 25-year journey in Life Simulator</p>
            
            <div style="position: relative;">
                <div class="profession-grid" id="profession-grid">
                    <!-- Profession cards will be dynamically generated here -->
                </div>
                <div id="scroll-hint" style="text-align: center; margin-top: 10px; font-size: 0.9em; color: #666; opacity: 0.8;">
                    ↓ Scroll to see more career options ↓
                </div>
            </div>
            
            <p style="margin-top: 20px; font-size: 0.9em; color: #666;">
                Each profession includes food, housing, utilities, phone, internet, and other basic expenses.
            </p>
        </div>
    </div>
    
    <div class="game-over" id="game-over">
        <div class="game-over-content">
            <h2 id="game-over-title">Game Over</h2>
            <p id="game-over-message"></p>
            <div id="final-stats"></div>
            <button class="btn" onclick="game.restart()">Play Again</button>
        </div>
    </div>
    
    <div class="expense-breakdown-modal" id="expense-breakdown-modal">
        <div class="expense-breakdown-content">
            <div class="stock-header">
                <h2>💰 Monthly Expense Breakdown</h2>
                <button class="btn" onclick="closeExpenseBreakdown()" style="background: #dc3545;">✕ Close</button>
            </div>
            <div id="expense-breakdown-list">
                <!-- Expense breakdown will be populated here -->
            </div>
        </div>
    </div>
    
    <!-- Real Estate Modal -->
    <div class="stock-info-modal" id="realestate-modal">
        <div class="expense-breakdown-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2>🏠 Real Estate Market</h2>
                <button class="btn" onclick="closeRealEstateModal()" style="background: #dc3545;">✕ Close</button>
            </div>
            
            <div style="text-align: center; margin-bottom: 20px;">
                <strong>💵 Available Cash: $<span id="realestate-cash-display">0</span></strong>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                <div>
                    <h4>🏠 Your Properties</h4>
                    <div id="owned-properties-list" style="background: #f8f9fa; padding: 10px; border-radius: 5px; min-height: 100px;">
                        <!-- Owned properties will be listed here -->
                    </div>
                </div>
                <div>
                    <h4>🛒 Available Properties</h4>
                    <div id="available-properties-list" style="max-height: 300px; overflow-y: auto;">
                        <!-- Available properties will be listed here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Vehicle Modal -->
    <div class="stock-info-modal" id="vehicle-modal">
        <div class="expense-breakdown-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2>🚗 Vehicle Dealership</h2>
                <button class="btn" onclick="closeVehicleModal()" style="background: #dc3545;">✕ Close</button>
            </div>
            
            <div style="text-align: center; margin-bottom: 20px;">
                <strong>💵 Available Cash: $<span id="vehicle-cash-display">0</span></strong>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                <div>
                    <h4>🚗 Your Vehicles</h4>
                    <div id="owned-vehicles-list" style="background: #f8f9fa; padding: 10px; border-radius: 5px; min-height: 100px;">
                        <!-- Owned vehicles will be listed here -->
                    </div>
                </div>
                <div>
                    <h4>🛒 Available Vehicles</h4>
                    <div id="available-vehicles-list" style="max-height: 300px; overflow-y: auto;">
                        <!-- Available vehicles will be listed here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Crypto Trading Modal -->
    <div class="stock-info-modal" id="crypto-trading-modal">
        <div class="expense-breakdown-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2>₿ Cryptocurrency Trading</h2>
                <button class="btn" onclick="closeCryptoTradingModal()" style="background: #dc3545;">✕ Close</button>
            </div>
            
            <div style="text-align: center; margin-bottom: 20px;">
                <strong>💵 Available Cash: $<span id="crypto-cash-display">0</span></strong>
            </div>
            
            <div style="background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 5px; padding: 10px; margin-bottom: 15px;">
                <div style="color: #856404; font-size: 0.9em;">
                    ⚠️ <strong>Trading Fee:</strong> 0.5% fee applies to all crypto transactions
                </div>
            </div>
            
            <div id="crypto-trading-list" style="max-height: 400px; overflow-y: auto;">
                <!-- Crypto trading options will be populated here -->
            </div>
        </div>
    </div>

    <!-- Stock Trading Modal -->
    <div class="stock-info-modal" id="stock-trading-modal">
        <div class="expense-breakdown-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2>📈 Stock Trading</h2>
                <button class="btn" onclick="closeStockTradingModal()" style="background: #dc3545;">✕ Close</button>
            </div>
            
            <div style="text-align: center; margin-bottom: 20px;">
                <strong>💵 Available Cash: $<span id="stock-cash-display">0</span></strong>
            </div>
            
            <div id="stock-trading-list" style="flex: 1; overflow-y: auto; border: 1px solid #ddd; border-radius: 5px; padding: 10px; min-height: 0;">
                <!-- Stock trading options will be populated here -->
            </div>
        </div>
    </div>

    <!-- Bank Modal -->
    <div class="stock-info-modal" id="bank-modal">
        <div class="expense-breakdown-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2>🏦 Bank Services</h2>
                <button class="btn" onclick="closeBankModal()" style="background: #dc3545;">✕ Close</button>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                <div style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 5px;">
                    <h4>💵 Cash on Hand</h4>
                    <div style="font-size: 1.5em; font-weight: bold; color: #28a745;" id="bank-cash-display">$0</div>
                </div>
                <div style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 5px;">
                    <h4>🏦 Bank Balance</h4>
                    <div style="font-size: 1.5em; font-weight: bold; color: #007bff;" id="bank-balance-display">$0</div>
                </div>
                <div style="text-align: center; padding: 15px; background: #fff3cd; border-radius: 5px;">
                    <h4>💰 Savings (3% APY)</h4>
                    <div style="font-size: 1.5em; font-weight: bold; color: #856404;" id="savings-balance-display">$0</div>
                </div>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                <div style="padding: 15px; border: 1px solid #ddd; border-radius: 5px;">
                    <h4>💰 Deposit Cash</h4>
                    <input type="number" id="deposit-amount" placeholder="Enter amount" style="width: 100%; margin: 10px 0; padding: 8px;">
                    <button class="btn" onclick="handleBankDeposit()" style="width: 100%; background: #28a745;">Deposit</button>
                </div>
                <div style="padding: 15px; border: 1px solid #ddd; border-radius: 5px;">
                    <h4>💸 Withdraw Cash</h4>
                    <input type="number" id="withdraw-amount" placeholder="Enter amount" style="width: 100%; margin: 10px 0; padding: 8px;">
                    <button class="btn" onclick="handleBankWithdraw()" style="width: 100%; background: #007bff;">Withdraw</button>
                </div>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div style="padding: 15px; border: 2px solid #ffc107; border-radius: 5px; background: #fff9e6;">
                    <h4>💰 Save Money (3% APY)</h4>
                    <input type="number" id="savings-deposit-amount" placeholder="Enter amount" style="width: 100%; margin: 10px 0; padding: 8px;">
                    <button class="btn" onclick="handleSavingsDeposit()" style="width: 100%; background: #ffc107; color: #000;">Save Money</button>
                </div>
                <div style="padding: 15px; border: 2px solid #ffc107; border-radius: 5px; background: #fff9e6;">
                    <h4>💸 Withdraw Savings</h4>
                    <input type="number" id="savings-withdraw-amount" placeholder="Enter amount" style="width: 100%; margin: 10px 0; padding: 8px;">
                    <button class="btn" onclick="handleSavingsWithdraw()" style="width: 100%; background: #856404;">Withdraw</button>
                </div>
            </div>
            
            <div style="margin-top: 20px; padding: 15px; background: #e9ecef; border-radius: 5px;">
                <h4>ℹ️ Banking Information</h4>
                <p style="margin: 5px 0;">• Bank deposits are safe from theft and emergencies (no interest)</p>
                <p style="margin: 5px 0;">• <strong>Savings account earns 3% annual interest (0.25% monthly)</strong></p>
                <p style="margin: 5px 0;">• All accounts protected from percentage-based theft events</p>
                <p style="margin: 5px 0;">• Instant transfers between cash, bank, and savings</p>
            </div>
        </div>
    </div>

    <!-- Player Status Modal -->
    <div class="stock-info-modal" id="player-status-modal">
        <div class="player-status-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                <h2>👤 Player Status</h2>
                <button class="btn" onclick="closePlayerStatusModal()" style="background: #dc3545;">✕ Close</button>
            </div>
            <div id="player-status-content" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 30px;">
                <!-- Player status will be populated here -->
            </div>
        </div>
    </div>

    <!-- Cash Flow History Modal -->
    <div class="stock-info-modal" id="cashflow-modal">
        <div class="expense-breakdown-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2>💰 Cash Flow History</h2>
                <button class="btn" onclick="closeCashFlowModal()" style="background: #dc3545;">✕ Close</button>
            </div>
            <div id="cashflow-history-list" style="max-height: 400px; overflow-y: auto; background: #f8f9fa; padding: 15px; border-radius: 5px;">
                <!-- Cash flow history will be populated here -->
            </div>
        </div>
    </div>

    <div class="stock-info-modal" id="stock-info-modal">
        <div class="stock-info-content">
            <div class="stock-header">
                <h2>📈 Market Information</h2>
                <button class="btn" onclick="closeStockInfo()" style="background: #dc3545;">✕ Close</button>
            </div>
            <div id="current-date-info" style="text-align: center; margin-bottom: 20px; font-size: 1.1em; color: #666;">
                Current Date: <span id="stock-current-date">Jan 2000</span>
            </div>
            <div class="stock-grid">
                <div class="stock-section">
                    <h3>📊 Stocks</h3>
                    <div id="stocks-info" style="max-height: 400px; overflow-y: auto; border: 1px solid #ddd; border-radius: 5px; padding: 10px;">
                        <!-- Stock prices will be populated here -->
                    </div>
                </div>
                <div class="stock-section">
                    <h3>₿ Cryptocurrency</h3>
                    <div id="crypto-info">
                        <!-- Crypto prices will be populated here -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="event-popup" id="event-popup">
        <div class="event-popup-content">
            <div class="event-title" id="event-popup-title">Event Title</div>
            <div class="event-description" id="event-popup-description">Event description goes here.</div>
            <div class="event-impact">
                <div class="event-cost" id="event-popup-cost">Cost: $0</div>
                <div class="event-effects" id="event-popup-effects" style="margin-top: 10px;">
                    <!-- All stat effects will be displayed here -->
                </div>
            </div>
            <button class="btn" onclick="closeEventPopup()" style="background: #2196F3;">Continue</button>
        </div>
    </div>
    
    <!-- Pets Modal -->
    <div class="stock-info-modal" id="pets-modal">
        <div class="stock-info-content">
            <div class="stock-header">
                <h2>🐾 Pet Management</h2>
                <button class="btn" onclick="closePetsModal()" style="background: #dc3545;">✕ Close</button>
            </div>
            
            <div class="pets-container">
                <!-- Owned Pets Section -->
                <div class="pets-section">
                    <h3>🏠 Your Pets</h3>
                    <div id="owned-pets" class="pets-grid">
                        <!-- Owned pets will be populated here -->
                    </div>
                </div>
                
                <!-- Available Pets Section -->
                <div class="pets-section">
                    <h3>🛒 Available Pets</h3>
                    <div class="pet-categories">
                        <button class="category-btn active" onclick="filterPetCategory('all')">All</button>
                        <button class="category-btn" onclick="filterPetCategory('small')">Small</button>
                        <button class="category-btn" onclick="filterPetCategory('medium')">Medium</button>
                        <button class="category-btn" onclick="filterPetCategory('exotic')">Exotic</button>
                        <button class="category-btn" onclick="filterPetCategory('premium')">Premium</button>
                    </div>
                    <div id="available-pets" class="pets-grid">
                        <!-- Available pets will be populated here -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Side Job Completion Modal -->
    <div class="stock-info-modal" id="sidejob-completion-modal">
        <div class="stock-info-content" style="max-width: 500px;">
            <div class="stock-header">
                <h2 id="sidejob-title">💼 Side Job Completed!</h2>
                <button class="btn" onclick="closeSideJobModal()" style="background: #dc3545;">✕ Close</button>
            </div>
            
            <div style="padding: 20px; text-align: center;">
                <div id="sidejob-icon" style="font-size: 48px; margin-bottom: 15px;">✅</div>
                
                <h3 id="sidejob-name" style="color: #28a745; margin-bottom: 10px;">Job Name</h3>
                
                <div id="sidejob-description" style="color: #666; margin-bottom: 20px; font-style: italic;">
                    Job description will appear here
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                    <div style="background: #e8f5e8; padding: 15px; border-radius: 8px;">
                        <div style="font-size: 24px; color: #28a745;">💰</div>
                        <div style="font-weight: bold; color: #28a745;">Payment</div>
                        <div id="sidejob-payment" style="font-size: 18px; font-weight: bold;">$0</div>
                    </div>
                    
                    <div style="background: #fff3cd; padding: 15px; border-radius: 8px;">
                        <div style="font-size: 24px; color: #856404;">⚡</div>
                        <div style="font-weight: bold; color: #856404;">Energy Cost</div>
                        <div id="sidejob-energy-cost" style="font-size: 18px; font-weight: bold;">0</div>
                    </div>
                </div>
                
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <div style="margin-bottom: 10px;">
                        <span style="font-weight: bold;">Duration:</span> 
                        <span id="sidejob-duration">0 hours</span>
                    </div>
                    <div>
                        <span style="font-weight: bold;">Energy Remaining:</span> 
                        <span id="sidejob-energy-remaining" style="color: #007bff; font-weight: bold;">0</span>
                    </div>
                </div>
                
                <div id="sidejob-season-info" style="background: #e7f3ff; padding: 10px; border-radius: 8px; margin-bottom: 15px; font-size: 0.9em; display: none;">
                    <strong>🍂 Seasonal Opportunity!</strong> This job is only available during certain seasons.
                </div>
                
                <button class="btn" onclick="closeSideJobModal()" style="background: #28a745; padding: 12px 30px; font-size: 16px;">
                    Great! Continue Playing
                </button>
            </div>
        </div>
    </div>
    
    <!-- Lottery Modal -->
    <div class="stock-info-modal" id="lottery-modal">
        <div class="stock-info-content" style="max-width: 600px;">
            <div class="stock-header">
                <h2>🎰 Lottery System</h2>
                <button class="btn" onclick="closeLotteryModal()" style="background: #dc3545;">✕ Close</button>
            </div>
            
            <div style="padding: 20px;">
                <!-- Current Month's Winning Numbers -->
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px; text-align: center;">
                    <h3 style="color: #007bff; margin-bottom: 10px;">🎱 This Month's Numbers</h3>
                    <div id="lottery-current-numbers" style="font-size: 24px; font-weight: bold; color: #dc3545;">
                        Loading...
                    </div>
                </div>
                
                <!-- Ticket Purchase Section -->
                <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <h3 style="color: #856404; margin-bottom: 15px;">🎫 Buy Lottery Ticket - $5</h3>
                    <p style="margin-bottom: 15px;">Select 6 numbers between 1-49:</p>
                    
                    <div style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; margin-bottom: 15px;">
                        <!-- Numbers 1-49 will be generated here -->
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <h4>Selected Numbers:</h4>
                        <div id="selected-numbers" style="font-size: 18px; font-weight: bold; color: #dc3545; min-height: 30px;">
                            None selected
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 10px;">
                        <button class="btn" onclick="clearLotterySelection()" style="background: #6c757d;">Clear</button>
                        <button class="btn" onclick="randomLotteryNumbers()" style="background: #17a2b8;">Quick Pick</button>
                        <button class="btn" onclick="buyLotteryTicket()" style="background: #28a745; flex: 1;">Buy Ticket ($5)</button>
                    </div>
                </div>
                
                <!-- Prize Structure -->
                <div style="background: #e8f5e8; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <h3 style="color: #28a745; margin-bottom: 15px;">💰 Prize Structure</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 14px;">
                        <div><strong>2 matches:</strong> $10</div>
                        <div><strong>3 matches:</strong> $100</div>
                        <div><strong>4 matches:</strong> $1,000</div>
                        <div><strong>5 matches:</strong> $10,000</div>
                        <div><strong>6 matches:</strong> $1,000,000 🎉</div>
                        <div style="grid-column: 1 / -1; text-align: center; margin-top: 10px; font-style: italic;">
                            Tickets are drawn at the end of each month
                        </div>
                    </div>
                </div>
                
                <!-- Current Tickets -->
                <div style="background: #e7f3ff; padding: 15px; border-radius: 8px;">
                    <h3 style="color: #007bff; margin-bottom: 15px;">🎫 Your Current Tickets</h3>
                    <div id="player-lottery-tickets">
                        No tickets purchased this month
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Self Learning Modal -->
    <div class="stock-info-modal" id="self-learning-modal">
        <div class="stock-info-content" style="max-width: 700px;">
            <div class="stock-header">
                <h2>📚 Self Learning Opportunities</h2>
                <button class="btn" onclick="closeSelfLearningModal()" style="background: #dc3545;">✕ Close</button>
            </div>
            
            <div style="padding: 20px;">
                <p style="margin-bottom: 20px;">Invest in yourself! Choose a learning opportunity to improve your skills and stats.</p>
                
                <div id="learning-opportunities" style="display: grid; gap: 15px;">
                    <!-- Learning opportunities will be populated here -->
                </div>
                
                <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                    <h4 style="margin-bottom: 10px;">💡 Learning Benefits</h4>
                    <p style="font-size: 0.9em; color: #666; margin: 5px 0;">• Each learning activity improves specific stats permanently</p>
                    <p style="font-size: 0.9em; color: #666; margin: 5px 0;">• Higher stats unlock better side jobs and opportunities</p>
                    <p style="font-size: 0.9em; color: #666; margin: 5px 0;">• Learning activities have cooldowns to prevent abuse</p>
                    <p style="font-size: 0.9em; color: #666; margin: 5px 0;">• Investment in yourself pays dividends over time</p>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        function toggleAssetCategory(categoryId) {
            const category = document.getElementById(categoryId);
            const header = category.previousElementSibling;
            const arrow = header.querySelector('span:last-child');
            
            if (category.classList.contains('expanded')) {
                category.classList.remove('expanded');
                arrow.textContent = '▶';
            } else {
                category.classList.add('expanded');
                arrow.textContent = '▼';
            }
        }
        
        function closeEventPopup() {
            document.getElementById('event-popup').style.display = 'none';
        }
        
        function showStockInfo() {
            if (game && game.gameState.gameStarted) {
                game.updateStockInfo();
                document.getElementById('stock-info-modal').style.display = 'flex';
            } else {
                alert('Please start the game first to view market information.');
            }
        }
        
        function closeStockInfo() {
            document.getElementById('stock-info-modal').style.display = 'none';
        }
        
        function showPlayerStatus() {
            if (game && game.gameState.gameStarted) {
                game.updatePlayerStatusModal();
                document.getElementById('player-status-modal').style.display = 'flex';
            } else {
                alert('Please start the game first to view player status.');
            }
        }
        
        function closePlayerStatusModal() {
            document.getElementById('player-status-modal').style.display = 'none';
        }
        
        function showCashFlowHistory() {
            if (game && game.gameState.gameStarted) {
                game.updateCashFlowModal();
                document.getElementById('cashflow-modal').style.display = 'flex';
            } else {
                alert('Please start the game first to view cash flow history.');
            }
        }
        
        function toggleBackgroundMusic() {
            if (game && game.gameState.gameStarted) {
                game.toggleMusic();
                // Update button text based on music state
                const button = document.getElementById('music-toggle-btn');
                if (game.musicEnabled) {
                    button.textContent = '🎵 Music';
                    button.style.background = '#ff6b35';
                } else {
                    button.textContent = '🔇 Music';
                    button.style.background = '#6c757d';
                }
            } else {
                alert('Please start the game first to control music.');
            }
        }
        
        function closeCashFlowModal() {
            document.getElementById('cashflow-modal').style.display = 'none';
        }
        
        function showBankModal() {
            if (game && game.gameState.gameStarted) {
                game.updateBankModal();
                document.getElementById('bank-modal').style.display = 'flex';
            } else {
                alert('Please start the game first to access bank services.');
            }
        }
        
        function closeBankModal() {
            document.getElementById('bank-modal').style.display = 'none';
        }
        
        function handleBankDeposit() {
            const amount = parseFloat(document.getElementById('deposit-amount').value);
            if (amount && amount > 0) {
                try {
                    game.handleDeposit(['deposit', amount.toString()]);
                    game.updateBankModal();
                    document.getElementById('deposit-amount').value = '';
                    game.updateUI();
                } catch (error) {
                    alert(error.message);
                }
            } else {
                alert('Please enter a valid amount to deposit.');
            }
        }
        
        function handleBankWithdraw() {
            const amount = parseFloat(document.getElementById('withdraw-amount').value);
            if (amount && amount > 0) {
                try {
                    game.handleWithdraw(['withdraw', amount.toString()]);
                    game.updateBankModal();
                    document.getElementById('withdraw-amount').value = '';
                    game.updateUI();
                } catch (error) {
                    alert(error.message);
                }
            } else {
                alert('Please enter a valid amount to withdraw.');
            }
        }
        
        function handleSavingsDeposit() {
            const amount = parseFloat(document.getElementById('savings-deposit-amount').value);
            if (amount && amount > 0) {
                try {
                    game.handleSavingsDeposit(['save', amount.toString()]);
                    game.updateBankModal();
                    document.getElementById('savings-deposit-amount').value = '';
                    game.updateUI();
                } catch (error) {
                    alert(error.message);
                }
            } else {
                alert('Please enter a valid amount to save.');
            }
        }
        
        function handleSavingsWithdraw() {
            const amount = parseFloat(document.getElementById('savings-withdraw-amount').value);
            if (amount && amount > 0) {
                try {
                    game.handleSavingsWithdraw(['withdraw-savings', amount.toString()]);
                    game.updateBankModal();
                    document.getElementById('savings-withdraw-amount').value = '';
                    game.updateUI();
                } catch (error) {
                    alert(error.message);
                }
            } else {
                alert('Please enter a valid amount to withdraw.');
            }
        }
        
        function showStockTradingModal() {
            if (game && game.gameState.gameStarted) {
                game.updateStockTradingModal();
                document.getElementById('stock-trading-modal').style.display = 'flex';
            } else {
                alert('Please start the game first to trade stocks.');
            }
        }
        
        function closeStockTradingModal() {
            document.getElementById('stock-trading-modal').style.display = 'none';
        }
        
        function handleStockBuy(symbol) {
            const amount = parseFloat(document.getElementById(`buy-${symbol}-amount`).value);
            if (amount && amount > 0) {
                try {
                    game.handleBuy(['buy', symbol, amount.toString()]);
                    game.updateStockTradingModal();
                    document.getElementById(`buy-${symbol}-amount`).value = '';
                    game.updateUI();
                } catch (error) {
                    alert(error.message);
                }
            } else {
                alert('Please enter a valid amount to buy.');
            }
        }
        
        function handleStockSell(symbol) {
            const amount = parseFloat(document.getElementById(`sell-${symbol}-amount`).value);
            if (amount && amount > 0) {
                try {
                    game.handleSell(['sell', symbol, amount.toString()]);
                    game.updateStockTradingModal();
                    document.getElementById(`sell-${symbol}-amount`).value = '';
                    game.updateUI();
                } catch (error) {
                    alert(error.message);
                }
            } else {
                alert('Please enter a valid amount to sell.');
            }
        }
        
        function showCryptoTradingModal() {
            if (game && game.gameState.gameStarted) {
                game.updateCryptoTradingModal();
                document.getElementById('crypto-trading-modal').style.display = 'flex';
            } else {
                alert('Please start the game first to trade cryptocurrency.');
            }
        }
        
        function closeCryptoTradingModal() {
            document.getElementById('crypto-trading-modal').style.display = 'none';
        }
        
        function handleCryptoBuy(symbol) {
            const amount = parseFloat(document.getElementById(`buy-${symbol}-crypto-amount`).value);
            if (amount && amount > 0) {
                try {
                    game.handleBuy(['buy', symbol, amount.toString()]);
                    game.updateCryptoTradingModal();
                    document.getElementById(`buy-${symbol}-crypto-amount`).value = '';
                    game.updateUI();
                } catch (error) {
                    alert(error.message);
                }
            } else {
                alert('Please enter a valid amount to buy.');
            }
        }
        
        function handleCryptoSell(symbol) {
            const amount = parseFloat(document.getElementById(`sell-${symbol}-crypto-amount`).value);
            if (amount && amount > 0) {
                try {
                    game.handleSell(['sell', symbol, amount.toString()]);
                    game.updateCryptoTradingModal();
                    document.getElementById(`sell-${symbol}-crypto-amount`).value = '';
                    game.updateUI();
                } catch (error) {
                    alert(error.message);
                }
            } else {
                alert('Please enter a valid amount to sell.');
            }
        }
        
        function showVehicleModal() {
            if (game && game.gameState.gameStarted) {
                game.updateVehicleModal();
                document.getElementById('vehicle-modal').style.display = 'flex';
            } else {
                alert('Please start the game first to buy vehicles.');
            }
        }
        
        function closeVehicleModal() {
            document.getElementById('vehicle-modal').style.display = 'none';
        }
        
        function handleVehicleBuy(vehicleId) {
            try {
                game.buyVehicle(vehicleId);
                game.updateVehicleModal();
                game.updateUI();
            } catch (error) {
                alert(error.message);
            }
        }
        
        function handleVehicleSell(vehicleId) {
            try {
                game.sellVehicle(vehicleId);
                game.updateVehicleModal();
                game.updateUI();
            } catch (error) {
                alert(error.message);
            }
        }
        
        function askParentsForHelp() {
            if (game && game.gameState.gameStarted) {
                try {
                    game.askParentsForHelp();
                    game.updateUI();
                } catch (error) {
                    alert(error.message);
                }
            } else {
                alert('Please start the game first.');
            }
        }
        
        function handleVehicleFinance(vehicleId) {
            try {
                game.financeVehicle(vehicleId);
                game.updateVehicleModal();
                game.updateUI();
            } catch (error) {
                alert(error.message);
            }
        }
        
        function showRealEstateModal() {
            if (game && game.gameState.gameStarted) {
                game.updateRealEstateModal();
                document.getElementById('realestate-modal').style.display = 'flex';
            } else {
                alert('Please start the game first to buy real estate.');
            }
        }
        
        function closeRealEstateModal() {
            document.getElementById('realestate-modal').style.display = 'none';
        }
        
        function handlePropertyBuy(propertyId) {
            try {
                game.buyProperty(propertyId);
                game.updateRealEstateModal();
                game.updateUI();
            } catch (error) {
                alert(error.message);
            }
        }
        
        function handlePropertySell(propertyId) {
            try {
                game.sellProperty(propertyId);
                game.updateRealEstateModal();
                game.updateUI();
            } catch (error) {
                alert(error.message);
            }
        }
        
        function handlePropertyFinance(propertyId) {
            try {
                game.financeProperty(propertyId);
                game.updateRealEstateModal();
                game.updateUI();
            } catch (error) {
                alert(error.message);
            }
        }
        
        function handlePropertyRent(propertyId) {
            try {
                game.rentProperty(propertyId);
                game.updateRealEstateModal();
                game.updateUI();
            } catch (error) {
                alert(error.message);
            }
        }
        
        function handleRentalEnd(rentalId) {
            try {
                game.endRental();
                game.updateRealEstateModal();
                game.updateUI();
            } catch (error) {
                alert(error.message);
            }
        }
        
        function handleStartRenting(propertyId) {
            try {
                game.rentOutProperty(propertyId);
                game.updateRealEstateModal();
                game.updateUI();
            } catch (error) {
                alert(error.message);
            }
        }
        
        function handleStopRenting(propertyId) {
            try {
                game.stopRentingProperty(propertyId);
                game.updateRealEstateModal();
                game.updateUI();
            } catch (error) {
                alert(error.message);
            }
        }
        
        function showExpenseBreakdown() {
            if (game && game.gameState.gameStarted) {
                game.updateExpenseBreakdown();
                document.getElementById('expense-breakdown-modal').style.display = 'flex';
            } else {
                alert('Please start the game first to view expense breakdown.');
            }
        }
        
        function closeExpenseBreakdown() {
            document.getElementById('expense-breakdown-modal').style.display = 'none';
        }
        
        // Pet system global functions
        function buyPet(petType) {
            try {
                if (game && game.gameState.gameStarted) {
                    game.handlePetPurchase(petType);
                } else {
                    alert('Please start the game first!');
                }
            } catch (error) {
                alert(error.message);
            }
        }
        
        function showPets() {
            if (game && game.gameState.gameStarted) {
                game.showPetStatus();
            } else {
                alert('Please start the game first!');
            }
        }
        
        function listPets() {
            if (game && game.gameState.gameStarted) {
                game.listAvailablePets();
            } else {
                alert('Please start the game first!');
            }
        }
        
        function sellPet(petId) {
            try {
                if (game && game.gameState.gameStarted) {
                    game.handlePetSale(petId);
                } else {
                    alert('Please start the game first!');
                }
            } catch (error) {
                alert(error.message);
            }
        }
        
        // Pets Modal Functions
        function showPetsModal() {
            if (game && game.gameState.gameStarted) {
                console.log('Opening pets modal...');
                console.log('Game pets loaded:', Object.keys(game.pets).length);
                updatePetsModal();
                document.getElementById('pets-modal').style.display = 'flex';
            } else {
                alert('Please start the game first!');
            }
        }
        
        function closePetsModal() {
            document.getElementById('pets-modal').style.display = 'none';
        }
        
        function updatePetsModal() {
            updatePetCapacityInfo();
            updateOwnedPets();
            updateAvailablePets();
        }
        
        function updatePetCapacityInfo() {
            // Add capacity info after the header
            const stockHeader = document.querySelector('#pets-modal .stock-header');
            let capacityInfo = document.getElementById('pet-capacity-info');
            
            if (!capacityInfo) {
                capacityInfo = document.createElement('div');
                capacityInfo.id = 'pet-capacity-info';
                capacityInfo.style.cssText = 'background: #f8f9fa; padding: 10px; margin: 10px 0; border-radius: 5px; border-left: 4px solid #007bff;';
                stockHeader.parentNode.insertBefore(capacityInfo, stockHeader.nextSibling);
            }
            
            const currentPets = game.gameState.pets.length;
            const maxCapacity = game.calculatePetCapacity();
            const livingSpace = game.getCurrentLivingSpace();
            
            if (game.gameState.properties.length === 0) {
                capacityInfo.innerHTML = `
                    <div style="text-align: center; color: #dc3545;">
                        <strong>🏠 Living with Parents</strong><br>
                        <span style="font-size: 0.9em;">You cannot have pets while living with your parents. Buy your own place first!</span>
                    </div>
                `;
            } else {
                const capacityColor = currentPets >= maxCapacity ? '#dc3545' : '#28a745';
                capacityInfo.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <strong>🏠 ${livingSpace}</strong>
                        </div>
                        <div style="color: ${capacityColor}; font-weight: bold;">
                            Pet Capacity: ${currentPets}/${maxCapacity}
                        </div>
                    </div>
                `;
            }
        }
        
        function updateOwnedPets() {
            const ownedPetsContainer = document.getElementById('owned-pets');
            const pets = game.gameState.pets;
            
            if (pets.length === 0) {
                ownedPetsContainer.innerHTML = `
                    <div style="text-align: center; color: #666; padding: 20px;">
                        <h4>No pets owned yet</h4>
                        <p>Choose from the available pets to get started!</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            pets.forEach(pet => {
                const ageInYears = (pet.ageMonths / 12).toFixed(1);
                const lifespanInYears = (pet.data.lifespan / 12).toFixed(1);
                const ageRatio = pet.ageMonths / pet.data.lifespan;
                const condition = ageRatio < 0.5 ? 0.6 : (ageRatio < 0.8 ? 0.4 : 0.2);
                const sellPrice = Math.floor(pet.data.purchaseCost * condition);
                
                html += `
                    <div class="pet-card owned">
                        <div class="pet-header">
                            <div class="pet-name">${pet.data.name}</div>
                            <div class="pet-age">${ageInYears}/${lifespanInYears} years</div>
                        </div>
                        <div class="pet-info">${pet.data.description}</div>
                        <div class="pet-stats">
                            <div class="pet-stat">Happiness: +${pet.data.happinessBonus}</div>
                            <div class="pet-stat">Monthly: $${pet.data.monthlyCost}</div>
                        </div>
                        <div class="pet-actions">
                            <button class="pet-btn sell" onclick="handlePetSell('${pet.id}')">
                                Sell for $${sellPrice}
                            </button>
                        </div>
                    </div>
                `;
            });
            
            ownedPetsContainer.innerHTML = html;
        }
        
        function updateAvailablePets() {
            const availablePetsContainer = document.getElementById('available-pets');
            const availablePets = game.pets;
            
            console.log('Available pets:', availablePets);
            console.log('Number of pets loaded:', Object.keys(availablePets).length);
            
            if (Object.keys(availablePets).length === 0) {
                availablePetsContainer.innerHTML = `
                    <div style="text-align: center; color: #666; padding: 20px;">
                        <h4>🐾 Loading pets...</h4>
                        <p>Please wait while pets.xml loads.</p>
                        <button onclick="updatePetsModal()" style="margin-top: 10px; padding: 5px 10px;">Refresh</button>
                    </div>
                `;
                return;
            }
            
            let html = '';
            Object.values(availablePets).forEach(pet => {
                const canAfford = game.gameState.portfolio.cash >= pet.purchaseCost;
                const meetsAge = game.gameState.ageYears >= pet.requirements.minAge && 
                               game.gameState.ageYears <= pet.requirements.maxAge;
                const meetsWisdom = !pet.requirements.minWisdom || 
                                  game.gameState.playerStatus.wisdom >= pet.requirements.minWisdom;
                const meetsCharm = !pet.requirements.minCharm || 
                                 game.gameState.playerStatus.charm >= pet.requirements.minCharm;
                const canBuy = canAfford && meetsAge && meetsWisdom && meetsCharm;
                
                const cardClass = canBuy ? '' : 'unavailable';
                const requirements = [];
                if (!canAfford) requirements.push(`Need $${pet.purchaseCost}`);
                if (!meetsAge) requirements.push(`Age ${pet.requirements.minAge}-${pet.requirements.maxAge}`);
                if (!meetsWisdom) requirements.push(`Wisdom ${pet.requirements.minWisdom}+`);
                if (!meetsCharm) requirements.push(`Charm ${pet.requirements.minCharm}+`);
                
                html += `
                    <div class="pet-card ${cardClass}" data-category="${getPetCategory(pet)}">
                        <div class="pet-header">
                            <div class="pet-name">${pet.name}</div>
                            <div class="pet-price">$${pet.purchaseCost}</div>
                        </div>
                        <div class="pet-info">${pet.description}</div>
                        <div class="pet-stats">
                            <div class="pet-stat">Happiness: +${pet.happinessBonus}</div>
                            <div class="pet-stat">Monthly: $${pet.monthlyCost}</div>
                            <div class="pet-stat">Lifespan: ${(pet.lifespan/12).toFixed(1)} years</div>
                            <div class="pet-stat">Type: ${pet.type}</div>
                        </div>
                        ${requirements.length > 0 ? `
                            <div class="pet-requirements">
                                Requirements: ${requirements.join(', ')}
                            </div>
                        ` : ''}
                        <div class="pet-actions">
                            <button class="pet-btn buy" 
                                    ${!canBuy ? 'disabled' : ''} 
                                    onclick="handlePetBuy('${pet.id}')">
                                ${canBuy ? 'Buy Pet' : 'Cannot Buy'}
                            </button>
                        </div>
                    </div>
                `;
            });
            
            availablePetsContainer.innerHTML = html;
        }
        
        function getPetCategory(pet) {
            if (pet.purchaseCost >= 1000) return 'premium';
            if (pet.type === 'exotic_mammal' || pet.type === 'reptile' || pet.type === 'aquatic') return 'exotic';
            if (pet.purchaseCost >= 100) return 'medium';
            return 'small';
        }
        
        function filterPetCategory(category) {
            // Update active button
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Show/hide pets based on category
            const petCards = document.querySelectorAll('#available-pets .pet-card');
            petCards.forEach(card => {
                if (category === 'all' || card.dataset.category === category) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }
        
        function handlePetBuy(petType) {
            try {
                game.handlePetPurchase(petType);
                updatePetsModal(); // Refresh the modal after purchase
                updatePetDisplay(); // Update main screen display
            } catch (error) {
                alert(error.message);
            }
        }
        
        function handlePetSell(petId) {
            if (confirm('Are you sure you want to sell this pet? You will lose the happiness bonus.')) {
                try {
                    game.handlePetSale(petId);
                    updatePetsModal(); // Refresh the modal after sale
                    updatePetDisplay(); // Update main screen display
                } catch (error) {
                    alert(error.message);
                }
            }
        }
        
        // Global function to test pet loading - accessible from browser console
        function testPetLoading() {
            console.log('=== Pet Loading Test ===');
            console.log('Game object exists:', !!game);
            console.log('Game started:', game?.gameState?.gameStarted);
            console.log('Pets loaded:', Object.keys(game?.pets || {}).length);
            console.log('First 5 pets:', Object.keys(game?.pets || {}).slice(0, 5));
            console.log('Sample pet data:', game?.pets?.goldfish);
            return game?.pets || {};
        }
        
        // Test function to buy a pet for demo - accessible from browser console
        function testBuyPet(petType = 'goldfish') {
            if (game && game.gameState.gameStarted) {
                try {
                    game.handlePetPurchase(petType);
                    updatePetDisplay();
                    console.log(`Successfully bought ${petType}!`);
                } catch (error) {
                    console.error('Failed to buy pet:', error.message);
                }
            } else {
                console.error('Game not started!');
            }
        }
        
        // Test function to show available events - accessible from browser console
        function testEventLoading() {
            console.log('=== Event Loading Test ===');
            console.log('Game object exists:', !!game);
            console.log('Events loaded:', game?.events?.length || 0);
            console.log('Event cooldowns:', Object.keys(game?.eventCooldowns || {}));
            if (game?.events?.length > 0) {
                console.log('First 10 events:');
                game.events.slice(0, 10).forEach((event, i) => {
                    console.log(`${i+1}. ${event.id}: ${event.description} (weight: ${event.weight})`);
                });
            }
            return game?.events || [];
        }
        
        // Side job function
        function doOneTimeSideJob() {
            if (game && game.gameState.gameStarted) {
                game.doOneTimeSideJob();
            } else {
                alert('Please start the game first!');
            }
        }
        
        // Test function to show available side jobs - accessible from browser console  
        function testSideJobLoading() {
            console.log('=== Side Job Loading Test ===');
            console.log('Game object exists:', !!game);
            console.log('Side jobs loaded:', Object.keys(game?.sideJobs || {}).length);
            console.log('Current energy:', game?.gameState?.playerStatus?.energy || 0);
            console.log('Current season:', game?.getCurrentSeason?.() || 'unknown');
            
            if (game?.sideJobs) {
                const availableJobs = game.getAvailableSideJobs();
                console.log(`Available jobs for current player: ${availableJobs.length}`);
                availableJobs.slice(0, 5).forEach((job, i) => {
                    console.log(`${i+1}. ${job.name}: $${job.paymentRange[0]}-${job.paymentRange[1]} (${job.energyCost} energy)`);
                });
            }
            return game?.sideJobs || {};
        }
        
        // Side Job Completion Modal Functions
        function showSideJobCompletionModal(jobData, payment, energyRemaining) {
            // Populate modal with job details
            document.getElementById('sidejob-name').textContent = jobData.name;
            document.getElementById('sidejob-description').textContent = jobData.description;
            document.getElementById('sidejob-payment').textContent = `$${payment}`;
            document.getElementById('sidejob-energy-cost').textContent = jobData.energyCost;
            document.getElementById('sidejob-duration').textContent = jobData.duration;
            document.getElementById('sidejob-energy-remaining').textContent = energyRemaining;
            
            // Show seasonal info if it's a seasonal job
            const seasonInfo = document.getElementById('sidejob-season-info');
            if (jobData.seasonal) {
                seasonInfo.style.display = 'block';
                seasonInfo.innerHTML = `<strong>🍂 Seasonal Opportunity!</strong> This job is only available during ${jobData.seasonal}.`;
            } else {
                seasonInfo.style.display = 'none';
            }
            
            // Set appropriate icon based on job type
            const iconElement = document.getElementById('sidejob-icon');
            if (jobData.paymentRange[1] >= 200) {
                iconElement.textContent = '🌟'; // Premium job
            } else if (jobData.seasonal) {
                iconElement.textContent = '🍂'; // Seasonal job
            } else if (jobData.energyCost >= 30) {
                iconElement.textContent = '💪'; // Physical job
            } else {
                iconElement.textContent = '✅'; // Regular job
            }
            
            // Show the modal
            document.getElementById('sidejob-completion-modal').style.display = 'flex';
        }
        
        function closeSideJobModal() {
            document.getElementById('sidejob-completion-modal').style.display = 'none';
        }
        
        // Lottery Modal Functions
        let selectedLotteryNumbers = [];
        
        function showLotteryModal() {
            if (game && game.gameState.gameStarted) {
                updateLotteryModal();
                document.getElementById('lottery-modal').style.display = 'flex';
            } else {
                alert('Please start the game first!');
            }
        }
        
        function closeLotteryModal() {
            document.getElementById('lottery-modal').style.display = 'none';
        }
        
        function updateLotteryModal() {
            // Update current month's numbers
            const currentNumbers = game.gameState.monthlyLotteryNumbers;
            if (currentNumbers) {
                document.getElementById('lottery-current-numbers').textContent = currentNumbers.join(' - ');
            } else {
                document.getElementById('lottery-current-numbers').textContent = 'Numbers not generated yet';
            }
            
            // Generate number grid
            const numbersGrid = document.querySelector('#lottery-modal .stock-info-content div[style*="grid-template-columns: repeat(7, 1fr)"]');
            numbersGrid.innerHTML = '';
            
            for (let i = 1; i <= 49; i++) {
                const button = document.createElement('button');
                button.textContent = i;
                button.style.cssText = 'padding: 8px; border: 2px solid #ddd; background: white; cursor: pointer; border-radius: 4px; font-weight: bold;';
                button.onclick = () => toggleLotteryNumber(i);
                button.id = `lottery-num-${i}`;
                numbersGrid.appendChild(button);
            }
            
            // Update player tickets
            updatePlayerLotteryTickets();
            
            // Clear selection
            selectedLotteryNumbers = [];
            updateSelectedNumbers();
        }
        
        function toggleLotteryNumber(number) {
            const button = document.getElementById(`lottery-num-${number}`);
            const index = selectedLotteryNumbers.indexOf(number);
            
            if (index > -1) {
                // Remove number
                selectedLotteryNumbers.splice(index, 1);
                button.style.background = 'white';
                button.style.color = 'black';
                button.style.borderColor = '#ddd';
            } else {
                // Add number (if less than 6)
                if (selectedLotteryNumbers.length < 6) {
                    selectedLotteryNumbers.push(number);
                    button.style.background = '#dc3545';
                    button.style.color = 'white';
                    button.style.borderColor = '#dc3545';
                } else {
                    alert('You can only select 6 numbers!');
                }
            }
            
            updateSelectedNumbers();
        }
        
        function updateSelectedNumbers() {
            const display = document.getElementById('selected-numbers');
            if (selectedLotteryNumbers.length === 0) {
                display.textContent = 'None selected';
            } else {
                display.textContent = selectedLotteryNumbers.sort((a, b) => a - b).join(' - ');
            }
        }
        
        function clearLotterySelection() {
            selectedLotteryNumbers.forEach(num => {
                const button = document.getElementById(`lottery-num-${num}`);
                button.style.background = 'white';
                button.style.color = 'black';
                button.style.borderColor = '#ddd';
            });
            selectedLotteryNumbers = [];
            updateSelectedNumbers();
        }
        
        function randomLotteryNumbers() {
            clearLotterySelection();
            
            while (selectedLotteryNumbers.length < 6) {
                const num = Math.floor(Math.random() * 49) + 1;
                if (!selectedLotteryNumbers.includes(num)) {
                    selectedLotteryNumbers.push(num);
                    const button = document.getElementById(`lottery-num-${num}`);
                    button.style.background = '#dc3545';
                    button.style.color = 'white';
                    button.style.borderColor = '#dc3545';
                }
            }
            
            updateSelectedNumbers();
        }
        
        function buyLotteryTicket() {
            if (selectedLotteryNumbers.length !== 6) {
                alert('Please select exactly 6 numbers!');
                return;
            }
            
            try {
                game.buyLotteryTicket([...selectedLotteryNumbers]);
                clearLotterySelection();
                updatePlayerLotteryTickets();
                game.updateUI();
            } catch (error) {
                alert(error.message);
            }
        }
        
        function updatePlayerLotteryTickets() {
            const display = document.getElementById('player-lottery-tickets');
            const tickets = game.gameState.lotteryTickets;
            
            if (tickets.length === 0) {
                display.innerHTML = 'No tickets purchased this month';
            } else {
                display.innerHTML = tickets.map((ticket, index) => 
                    `<div style="background: white; padding: 10px; border-radius: 4px; margin-bottom: 5px; border: 1px solid #ddd;">
                        <strong>Ticket ${index + 1}:</strong> ${ticket.numbers.join(' - ')}
                    </div>`
                ).join('');
            }
        }
        
        // Self Learning Modal Functions
        function showSelfLearningModal() {
            console.log('showSelfLearningModal called');
            console.log('game:', game);
            console.log('game.gameState:', game ? game.gameState : 'no game');
            console.log('game.events:', game ? game.events : 'no events');
            console.log('Total events loaded:', game ? game.events.length : 0);
            
            if (game && game.gameState.gameStarted) {
                // Check if events are loaded
                if (!game.events || game.events.length === 0) {
                    alert('Events are still loading. Please wait a moment and try again.');
                    return;
                }
                updateSelfLearningModal();
                document.getElementById('self-learning-modal').style.display = 'flex';
            } else {
                alert('Please start the game first!');
            }
        }
        
        function closeSelfLearningModal() {
            document.getElementById('self-learning-modal').style.display = 'none';
        }
        
        function updateSelfLearningModal() {
            const container = document.getElementById('learning-opportunities');
            
            // Get learning events from the game (filter learning category events)
            console.log('All events:', game.events);
            console.log('Event categories:', game.events.map(e => `${e.id}: ${e.category}`));
            let learningEvents = game.events.filter(event => event.category === 'learning');
            
            // Fallback: If no learning events found in XML, create some manually
            if (learningEvents.length === 0) {
                console.log('No learning events found in XML, creating manual ones');
                const fallbackLearningEvents = [
                    {
                        id: 'online_course',
                        category: 'learning',
                        description: 'Online Productivity Course',
                        detailedDescription: 'Take an online course to improve your focus and time management skills.',
                        costRange: [50, 200],
                        effects: { focus: 3, wisdom: 1 },
                        cooldown: 36,
                        weight: 0.3
                    },
                    {
                        id: 'financial_book',
                        category: 'learning',
                        description: 'Read Financial Book',
                        detailedDescription: 'Study personal finance to improve your money management wisdom.',
                        costRange: [20, 50],
                        effects: { wisdom: 2, focus: 1 },
                        cooldown: 24,
                        weight: 0.4
                    },
                    {
                        id: 'coding_bootcamp',
                        category: 'learning',
                        description: 'Coding Bootcamp',
                        detailedDescription: 'Intensive programming course to significantly boost your technical skills.',
                        costRange: [500, 1000],
                        effects: { wisdom: 5, focus: 3 },
                        cooldown: 60,
                        weight: 0.1
                    }
                ];
                
                // Add fallback events to the main game.events array so triggerLearningEvent can find them
                game.events.push(...fallbackLearningEvents);
                learningEvents = fallbackLearningEvents;
            }
            console.log('Learning events found:', learningEvents.length);
            console.log('Learning events:', learningEvents);
            if (learningEvents.length > 0) {
                console.log('Sample learning event:', learningEvents[0]);
            }
            
            // Now learningEvents should always have content (either from XML or fallback)
            if (learningEvents.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 20px; color: #666;">No learning opportunities available.</div>';
                return;
            }
            
            container.innerHTML = learningEvents.map(event => {
                const isOnCooldown = game.eventCooldowns && game.eventCooldowns[event.id] && game.eventCooldowns[event.id] > 0;
                const maxCost = event.costRange ? event.costRange[1] : 0;
                const canAfford = game.gameState.portfolio.cash >= maxCost;
                const cooldownInfo = isOnCooldown ? `(Available in ${game.eventCooldowns[event.id]} months)` : '';
                
                // Format stat benefits
                const benefits = [];
                const effects = event.effects || {};
                if (effects.happiness > 0) benefits.push(`😊 +${effects.happiness} Happiness`);
                if (effects.energy > 0) benefits.push(`⚡ +${effects.energy} Energy`);
                if (effects.focus > 0) benefits.push(`🎯 +${effects.focus} Focus`);
                if (effects.wisdom > 0) benefits.push(`🧠 +${effects.wisdom} Wisdom`);
                if (effects.charm > 0) benefits.push(`💫 +${effects.charm} Charm`);
                if (effects.luck > 0) benefits.push(`🍀 +${effects.luck} Luck`);
                
                const disabled = isOnCooldown || !canAfford ? 'disabled' : '';
                const buttonStyle = disabled ? 'background: #6c757d; cursor: not-allowed;' : 'background: #28a745;';
                
                return `
                    <div style="border: 1px solid #ddd; border-radius: 8px; padding: 15px; background: white;">
                        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px;">
                            <div style="flex: 1;">
                                <h4 style="margin: 0 0 5px 0; color: #2c3e50;">${event.description}</h4>
                                <p style="margin: 0; font-size: 0.9em; color: #666;">${event.detailedDescription}</p>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-weight: bold; color: #dc3545;">$${event.costRange ? event.costRange[0] : 0}-${event.costRange ? event.costRange[1] : 0}</div>
                                <div style="font-size: 0.8em; color: #666;">${cooldownInfo}</div>
                            </div>
                        </div>
                        <div style="margin-bottom: 10px;">
                            <strong>Benefits:</strong><br>
                            <span style="font-size: 0.9em;">${benefits.join(' • ')}</span>
                        </div>
                        <button class="btn" onclick="startLearningActivity('${event.id}')" 
                                style="${buttonStyle} padding: 8px 16px;" ${disabled}>
                            ${isOnCooldown ? 'On Cooldown' : canAfford ? 'Start Learning' : 'Cannot Afford'}
                        </button>
                    </div>
                `;
            }).join('');
        }
        
        function startLearningActivity(eventId) {
            try {
                game.triggerLearningEvent(eventId);
                updateSelfLearningModal();
                game.updateUI();
            } catch (error) {
                alert(error.message);
            }
        }
        
        // Update pet display on main screen
        function updatePetDisplay() {
            const petsDisplay = document.getElementById('pets-display');
            const petsVisual = document.getElementById('pets-visual');
            const ownedPets = game?.gameState?.pets || [];
            
            if (ownedPets.length === 0) {
                petsDisplay.style.display = 'none';
                return;
            }
            
            petsDisplay.style.display = 'block';
            
            let html = '';
            ownedPets.forEach(pet => {
                const ageInYears = (pet.ageMonths / 12).toFixed(1);
                const emoji = pet.data.emoji || '🐾';
                
                html += `
                    <div class="pet-visual-item" onclick="showPetsModal()" title="Click to manage pets">
                        <div class="pet-emoji">${emoji}</div>
                        <div class="pet-name-small">${pet.data.name}</div>
                        <div class="pet-age-small">${ageInYears}y</div>
                    </div>
                `;
            });
            
            petsVisual.innerHTML = html;
        }
        
        // Player Setup System
        let selectedPortrait = 1;
        
        function initializePlayerSetup() {
            generatePortraitOptions();
            randomizeStats();
        }
        
        function generatePortraitOptions() {
            const portraitGrid = document.getElementById('portrait-grid');
            const portraits = [
                { id: 1, emoji: '👨‍💼', name: 'Professional' },
                { id: 2, emoji: '👩‍💼', name: 'Executive' },
                { id: 3, emoji: '👨‍🎓', name: 'Graduate' },
                { id: 4, emoji: '👩‍🎓', name: 'Scholar' },
                { id: 5, emoji: '👨‍💻', name: 'Tech Guy' },
                { id: 6, emoji: '👩‍💻', name: 'Developer' },
                { id: 7, emoji: '👨‍🔬', name: 'Scientist' },
                { id: 8, emoji: '👩‍🔬', name: 'Researcher' },
                { id: 9, emoji: '👨‍🎨', name: 'Artist' },
                { id: 10, emoji: '👩‍🎨', name: 'Creative' },
                { id: 11, emoji: '👨‍🍳', name: 'Chef' },
                { id: 12, emoji: '👩‍🍳', name: 'Cook' }
            ];
            
            let html = '';
            portraits.forEach(portrait => {
                html += `
                    <div class="portrait-option ${portrait.id === 1 ? 'selected' : ''}" 
                         onclick="selectPortrait(${portrait.id})" 
                         data-portrait-id="${portrait.id}">
                        <div class="portrait-emoji">${portrait.emoji}</div>
                        <div class="portrait-name">${portrait.name}</div>
                    </div>
                `;
            });
            
            portraitGrid.innerHTML = html;
        }
        
        function selectPortrait(portraitId) {
            // Remove selection from all portraits
            document.querySelectorAll('.portrait-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            // Add selection to clicked portrait
            document.querySelector(`[data-portrait-id="${portraitId}"]`).classList.add('selected');
            selectedPortrait = portraitId;
        }
        
        function randomizeStats() {
            // Generate random stats with some balance (total around 300-400)
            const baseStats = {
                energy: 50 + Math.floor(Math.random() * 30),    // 50-79
                focus: 45 + Math.floor(Math.random() * 35),     // 45-79
                wisdom: 40 + Math.floor(Math.random() * 40),    // 40-79
                charm: 35 + Math.floor(Math.random() * 45),     // 35-79
                luck: 30 + Math.floor(Math.random() * 50),      // 30-79
                psp: 50 + Math.floor(Math.random() * 101)       // 50-150
            };
            
            // Update display (random values are the max values, so just show the value)
            document.getElementById('stat-energy').textContent = `${baseStats.energy}`;
            document.getElementById('stat-focus').textContent = `${baseStats.focus}`;
            document.getElementById('stat-wisdom').textContent = `${baseStats.wisdom}`;
            document.getElementById('stat-charm').textContent = `${baseStats.charm}`;
            document.getElementById('stat-luck').textContent = `${baseStats.luck}`;
            document.getElementById('stat-psp').textContent = `${baseStats.psp}`;
            
            // Store stats for later use
            window.playerSetupStats = baseStats;
        }
        
        function startGameWithSetup() {
            // Get player name or use default "Guest"
            const playerNameInput = document.getElementById('player-name').value.trim();
            const playerName = playerNameInput || 'Guest';
            
            // Get selected portrait
            const portraits = [
                null, // index 0 unused
                '👨‍💼', '👩‍💼', '👨‍🎓', '👩‍🎓', '👨‍💻', '👩‍💻',
                '👨‍🔬', '👩‍🔬', '👨‍🎨', '👩‍🎨', '👨‍🍳', '👩‍🍳'
            ];
            
            // Store player setup data
            window.playerSetupData = {
                name: playerName,
                portrait: portraits[selectedPortrait],
                stats: window.playerSetupStats || {
                    energy: 75, focus: 70, wisdom: 65, 
                    charm: 60, luck: 55, psp: 50
                }
            };
            
            // Hide player setup and show profession selection
            document.getElementById('player-setup').style.display = 'none';
            document.getElementById('profession-selection').style.display = 'flex';
            
            console.log('Player setup completed:', window.playerSetupData);
        }
        
        // Initialize setup page when DOM loads
        document.addEventListener('DOMContentLoaded', function() {
            // Show player setup first
            document.getElementById('player-setup').style.display = 'flex';
            document.getElementById('profession-selection').style.display = 'none';
            
            // Initialize setup components
            setTimeout(() => {
                initializePlayerSetup();
            }, 100);
        });
        
        // Function to update player info display on main page
        function updatePlayerInfoDisplay() {
            if (window.playerSetupData && game?.gameState?.gameStarted) {
                document.getElementById('player-name-display').textContent = window.playerSetupData.name;
                document.getElementById('player-portrait-display').textContent = window.playerSetupData.portrait;
                document.getElementById('player-age-display').textContent = game.gameState.ageYears;
                document.getElementById('player-info').style.display = 'block';
            }
        }
        
        // Celebration Effects Function
        function showCelebration(emoji, message, confettiColor = '#ffd700') {
            // Create celebration overlay
            const overlay = document.createElement('div');
            overlay.className = 'celebration-overlay';
            
            // Create confetti
            for (let i = 0; i < 9; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                overlay.appendChild(confetti);
            }
            
            // Create celebration message
            const messageDiv = document.createElement('div');
            messageDiv.className = 'celebration-message';
            messageDiv.innerHTML = `
                <span class="celebration-emoji">${emoji}</span>
                ${message}
            `;
            
            overlay.appendChild(messageDiv);
            document.body.appendChild(overlay);
            
            // Remove overlay after animation
            setTimeout(() => {
                overlay.remove();
            }, 3000);
        }
    </script>
    
        
    </div> <!-- End game-container -->
    
    
    <script src="game.js"></script>
</body>
</html>